<UserControl x:Class="HealthLogger.Views.HistorialClinicoView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="clr-namespace:MaterialDesignThemes.Wpf;assembly=MaterialDesignThemes.Wpf"
             mc:Ignorable="d"
             FontSize="16"
             FontFamily="Roboto"
             d:DesignHeight="800" d:DesignWidth="900">

    <Grid Background="#f0f0f0">
        <Border Background="White" 
                Margin="20" 
                Padding="30" 
                CornerRadius="6" 
                Effect="{DynamicResource MaterialDesignElevation3}">

            <Grid>
                <Grid.RowDefinitions>
                    <!-- Fila fija: barra superior -->
                    <RowDefinition Height="Auto"/>
                    <!-- Fila desplazable: contenido -->
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- 🔹 Encabezado fijo -->
                <DockPanel Grid.Row="0" Margin="0 0 0 20">
                    <Button Content="⟵ Volver"
                            Click="Volver_Click"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            DockPanel.Dock="Left" Width="100"/>

                    <TextBlock Text="{Binding PacienteNombreCompleto}" 
                               FontSize="20" FontWeight="Bold"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"/>

                    <Button Content="💾 Guardar Cambios"
                            Click="Guardar_Click"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            DockPanel.Dock="Right" Width="170"/>
                </DockPanel>

                <!-- 🔹 Contenido desplazable -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Historial Clínico" HorizontalAlignment="Center"
                            FontWeight="Bold" FontSize="32" Margin="0 0 0 10"/>

                        <!-- Datos personales -->
                        <Grid Margin="0 0 0 20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="10">
                                <TextBlock Text="Datos personales" 
                                           FontWeight="Bold" FontSize="16" Margin="0 0 0 10"/>
                                <TextBox materialDesign:HintAssist.Hint="Nombres" TextChanged="AnyFieldChanged"
                                         Text="{Binding Paciente.Nombres, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0 5"/>
                                <TextBox materialDesign:HintAssist.Hint="Apellidos" TextChanged="AnyFieldChanged"
                                         Text="{Binding Paciente.Apellidos, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0 5"/>
                                <TextBox materialDesign:HintAssist.Hint="CI / Documento" TextChanged="AnyFieldChanged"
                                         Text="{Binding Paciente.CI, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0 5"/>
                                <TextBox materialDesign:HintAssist.Hint="Teléfono" TextChanged="AnyFieldChanged"
                                         Text="{Binding Paciente.Telefono, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Margin="0 5"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="10">
                                <TextBlock Text="Información médica" 
                                           FontWeight="Bold" FontSize="16" Margin="0 0 0 10"/>
                                <ComboBox materialDesign:HintAssist.Hint="Sexo"
                                          ItemsSource="{Binding DataContext.OpcionesSexo}"
                                          DisplayMemberPath="Texto"
                                          SelectedValuePath="Valor"
                                          SelectedValue="{Binding Paciente.Sexo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                          SelectionChanged="AnyFieldChanged"
                                          Margin="0 5"/>
                                <DatePicker SelectedDate="{Binding Paciente.FechaNacimiento, UpdateSourceTrigger=PropertyChanged}" Margin="0 5"/>
                                <TextBox materialDesign:HintAssist.Hint="Edad"
                                         Text="{Binding Paciente.Edad, Mode=OneWay}"
                                         IsReadOnly="True"
                                         Margin="0 5"/>
                            </StackPanel>
                        </Grid>

                        <!-- Cuerpo clínico tipo documento -->
                        <StackPanel>
                            <TextBlock Text="Antecedentes" FontWeight="Bold" FontSize="16" Margin="0 10 0 5"/>
                            <TextBox x:Name="TxtAntecedentes"
                                     AcceptsReturn="True"
                                     MinHeight="80"
                                     TextWrapping="Wrap"
                                     TextChanged="AutoGrowTextBox"
                                     Text="{Binding Paciente.Antecedentes, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                            <TextBlock Text="Alergias" FontWeight="Bold" FontSize="16" Margin="0 15 0 5"/>
                            <TextBox x:Name="TxtAlergias"
                                     AcceptsReturn="True"
                                     MinHeight="80"
                                     TextWrapping="Wrap"
                                     TextChanged="AutoGrowTextBox"
                                     Text="{Binding Paciente.Alergias, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                            <TextBlock Text="Observaciones" FontWeight="Bold" FontSize="16" Margin="0 15 0 5"/>
                            <TextBox x:Name="TxtObservaciones"
                                     AcceptsReturn="True"
                                     MinHeight="80"
                                     TextWrapping="Wrap"
                                     TextChanged="AutoGrowTextBox"
                                     Text="{Binding Paciente.Observaciones, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
